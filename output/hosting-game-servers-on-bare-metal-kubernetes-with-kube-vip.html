<!DOCTYPE html>

<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
<link href="http://gmpg.org/xfn/11" rel="profile"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<!-- Metadata -->
<meta content="A guide for hosting dedicated game servers on Kubernetes with kube-vip" name="description"/>
<meta content="A guide for hosting dedicated game servers on Kubernetes with kube-vip" property="og:description"/>
<meta content="Hosting Game Servers on Bare Metal Kubernetes with kube-vip" property="og:title"/>
<meta content="article" property="og:type"/>
<meta content="http://127.0.0.1:8000/hosting-game-servers-on-bare-metal-kubernetes-with-kube-vip.html" property="og:url"/>
<meta content="https://max-pfeiffer.github.io/blog/images/2025-04-23_game_server_hosting_on_kubernetes.png" property="og:image"/>
<!-- Enable responsiveness on mobile devices-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1" name="viewport">
<title>The Nerdy Tech Blog</title>
<!-- CSS -->
<link href="//fonts.googleapis.com/" rel="dns-prefetch"/>
<link href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Abril+Fatface|PT+Sans:400,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet"/>
<link href="http://127.0.0.1:8000/theme/css/poole.css" rel="stylesheet"/>
<link href="http://127.0.0.1:8000/theme/css/hyde.css" rel="stylesheet"/>
<link href="http://127.0.0.1:8000/theme/css/syntax.css" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" rel="stylesheet">
<!-- Feeds -->
<!-- Analytics -->
</link></meta><meta content="F3nYemi_dYYQckoOJ33wBp5BG4frj27_I6Iiianw594" name="google-site-verification"/><link href="/favicon.ico" rel="icon"/><link href="http://127.0.0.1:8000/hosting-game-servers-on-bare-metal-kubernetes-with-kube-vip.html" rel="canonical"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "BreadcrumbList", "itemListElement": [{"@type": "ListItem", "position": 1, "name": "The Nerdy Tech Blog", "item": "http://127.0.0.1:8000"}, {"@type": "ListItem", "position": 2, "name": "Hosting game servers on bare metal kubernetes with kube vip", "item": "http://127.0.0.1:8000/hosting-game-servers-on-bare-metal-kubernetes-with-kube-vip.html"}]}</script><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "author": {"@type": "Person", "name": "Max Pfeiffer"}, "publisher": {"@type": "Organization", "name": "The Nerdy Tech Blog", "logo": {"@type": "ImageObject", "url": "https://max-pfeiffer.github.io/blog/images/avatar.jpeg"}}, "headline": "Hosting Game Servers on Bare Metal Kubernetes with kube-vip", "about": "misc", "datePublished": "2025-04-23 13:00", "image": "https://max-pfeiffer.github.io/blog/images/2025-04-23_game_server_hosting_on_kubernetes.png"}</script></head>
<body class="theme-base-0d">
<div class="sidebar">
<div class="container sidebar-sticky">
<div class="sidebar-about">
<h1>
<a href="http://127.0.0.1:8000/">
<img class="profile-picture" src="http://127.0.0.1:8000/images/avatar.jpeg"/>
					The Nerdy Tech Blog
				</a>
</h1>
<p class="lead"></p>
<p class="lead"> </p>
<p></p>
</div>
<ul class="sidebar-nav">
<li><a href="http://127.0.0.1:8000/pages/about.html">About</a></li>
<li><a href="http://127.0.0.1:8000/pages/imprint.html">Imprint</a></li>
<li><a href="http://127.0.0.1:8000/pages/privacy.html">Privacy</a></li>
</ul>
<nav class="sidebar-social">
<a class="sidebar-social-item" href="https://github.com/max-pfeiffer" target="_blank">
<i class="fa fa-github"></i>
</a>
<a class="sidebar-social-item" href="http://127.0.0.1:8000/">
<i class="fa fa-rss"></i>
</a>
</nav>
<p class="sidebar-footer">Â© 2025 Max Pfeiffer</p>
</div>
</div> <div class="content container">
<div class="post">
<h1 class="post-title">Hosting Game Servers on Bare Metal Kubernetes with kube-vip</h1>
<span class="post-date">Wed 23 April 2025</span>
<p>Hosting game servers on Kubernetes is rather straight forward if you use the offerings of the main
cloud providers like <a href="https://aws.amazon.com/gametech/game-backend-infrastructure/">AWS</a>
or <a href="https://games.withgoogle.com/solutions/create-great-games/host/">Google</a>. If you were using these cloud offerings,
you might know that this can get rather expensive.</p>
<p>So how are you going to do that on bare metal Kubernetes? There are solutions like <a href="https://github.com/googleforgames/agones">Agones</a>
if you want to become very serious about it and want to run some game server farm. </p>
<p>But what if you happen to run your own Kubernetes clusters on bare metal and just want to host a couple of game servers
with low effort (like I do)? In this article, I will sketch out the solution I found for my use case.</p>
<h2>UDP protocol</h2>
<p>Usually dedicated game servers use UDP protocol for their client communication. Handling the network traffic for UDP
protocol is a bit challenging with Kubernetes: <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Kubernetes Ingress</a>
only supports TCP/HTTP protocols. Therefore, leveraging an ingress controller for this task is pointless.</p>
<p>So how can we handle the incoming UDP traffic and forward it to the game server in Kubernetes? The First part of the
solution is a <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a> of type LoadBalancer. Here
we need to declare all ports the game server uses and connect them via
<a href="https://kubernetes.io/docs/reference/kubernetes-api/service-resources/endpoints-v1/">EndPoints</a> to the
Deployment/Statefulset which runs the game server. Cloud provider's load balancers then connect to that Service and
configure the <code>ingress</code> in the <code>status.loadbalancer</code> field of that Service. For instance:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">status</span><span class="p">:</span>
<span class="w">  </span><span class="nt">loadBalancer</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ingress</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">111.112.12.34</span>
<span class="w">      </span><span class="nt">ipMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VIP</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">28015</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">28016</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">28016</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">28017</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">28082</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</code></pre></div>
<p>So an external IP address becomes assigned to that Service. The ingress traffic is routed to that service. And usually
egress traffic is routed through that external IP address as well. </p>
<h2>kube-vip</h2>
<p>How can we achieve this on bare metal Kubernetes? This is where the <a href="https://kube-vip.io/">kube-vip</a> project kicks in.</p>
<p><img alt="2025-04-23_game_server_hosting_on_kubernetes.png" src="http://127.0.0.1:8000/images/2025-04-23_game_server_hosting_on_kubernetes.png"/></p>
<p>With <a href="https://github.com/kube-vip/kube-vip-cloud-provider">kube-vip-cloud-provider</a> you can <a href="https://kube-vip.io/docs/usage/cloud-provider/#the-kube-vip-cloud-provider-configmap">configure external IP
addresses</a> for your Kubernetes
cluster. There are two options:</p>
<ul>
<li>pools of external IP addresses using a ConfigMap (load balanced)</li>
<li>single static IP address by annotating a service (not load balanced)</li>
</ul>
<p>With <a href="https://github.com/kube-vip/kube-vip">kube-vip</a> you can then connect and configure these external IP addresses to
a Service of type LoadBalancer. This is one of the features of <a href="https://github.com/kube-vip/kube-vip">kube-vip</a>.
Another feature of <a href="https://github.com/kube-vip/kube-vip">kube-vip</a> is <a href="https://kube-vip.io/docs/about/features/">providing a VIP and doing load balancing for the
Kubernetes control plane</a>. But this is not relevant here and can be
switched off. You can toggle any features <a href="https://kube-vip.io/docs/installation/flags/">using CLI flags</a>.</p>
<p><a href="https://github.com/kube-vip/kube-vip">kube-vip</a> can also
<a href="https://kube-vip.io/docs/usage/egress/">route the egress traffic through the external IP</a> you configured for a service.
This is what we need to use for the Service for our game server. </p>
<h2>kube-vip installation</h2>
<p>I choose to install <a href="https://github.com/kube-vip/kube-vip-cloud-provider">kube-vip-cloud-provider</a> and
<a href="https://github.com/kube-vip/kube-vip">kube-vip</a> using <a href="https://github.com/kube-vip/helm-charts">their Helm charts</a>.
This is convenient and works well. For the kube-vip <code>values.yaml</code> there are a couple of things to consider: we need to
configure <a href="https://kube-vip.io/docs/usage/egress/#using-kube-vip-egress">a special image with iptables to enable the egress-functionality</a>.
Also, we want to disable the control plane VIP functionality as we only want to use the Service feature. If we want to
<a href="https://kube-vip.io/docs/usage/kubernetes-services/#external-traffic-policy-kube-vip-v050">use the egress feature</a>,
we need to enable the <code>svc_election</code> feature. Our <code>values.yaml</code> should look like this eventually:</p>
<div class="highlight"><pre><span></span><code><span class="nt">image</span><span class="p">:</span>
<span class="w">  </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/kube-vip/kube-vip-iptables</span>
<span class="w">  </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">"v0.9.0"</span>

<span class="nt">env</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cp_enable</span><span class="p">:</span><span class="w"> </span><span class="s">"false"</span>
<span class="w">  </span><span class="nt">svc_enable</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
<span class="w">  </span><span class="nt">svc_election</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</code></pre></div>
<p><strong>Please note:</strong> I discovered <a href="https://github.com/kube-vip/helm-charts/issues/68">a bug in kube-vip Helm chart</a>.
For the ClusterRole, the permission to list pods was missing which was effecting egress config. Until my fix is merged,
you can patch the ClusterRole manually. </p>
<p>You can install the charts like so:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>kube-vip<span class="w"> </span>https://kube-vip.github.io/helm-charts
$<span class="w"> </span>helm<span class="w"> </span>install<span class="w"> </span>kube-vip-cloud-provider<span class="w"> </span>kube-vip-cloud-provider<span class="w"> </span>--namespace<span class="w"> </span>kube-system
$<span class="w"> </span>helm<span class="w"> </span>install<span class="w"> </span>kube-vip<span class="w"> </span>kube-vip<span class="w"> </span>--namespace<span class="w"> </span>kube-system<span class="w"> </span>--values<span class="w"> </span>values.yaml
</code></pre></div>
<h2>Service configuration</h2>
<p>After everything is up and running, you can install a Service for your game server. kube-vip supports services with
mixed protocols (TCP/UDP) for ports, so we can specify all ports in one service. There are a couple of things we
need to consider here additionally.</p>
<h3>Annotations</h3>
<p>First we need to annotate our service to enable the egress functionality with <code>kube-vip.io/egress: "true"</code>. If we want
to expose the server via a single static IP address, we need to add this annotation 
<code>kube-vip.io/loadbalancerIPs: "111.112.12.34"</code>,</p>
<h3>Service spec</h3>
<p>We need to have a Service with <code>type: LoadBalancer</code>. If we want to have the egress functionality, we need to set
<code>externalTrafficPolicy: Local</code>.</p>
<h3>Example</h3>
<p>For instance, a Service for a <a href="https://rust.facepunch.com/">Rust</a> dedicated server would look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">kube-vip.io/egress</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
<span class="w">    </span><span class="nt">kube-vip.io/loadbalancerIPs</span><span class="p">:</span><span class="w"> </span><span class="s">"111.112.12.34"</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rust-dedicated-server</span>
<span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rust</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rust-dedicated-server</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
<span class="w">  </span><span class="nt">externalTrafficPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Local</span><span class="w">  </span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server-port</span>
<span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30553</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">28015</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server-port</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rcon-port-udp</span>
<span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32396</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">28016</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rcon-port-udp</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rcon-port-tcp</span>
<span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32396</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">28016</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rcon-port-tcp</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">query-port</span>
<span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30401</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">28017</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">query-port</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-port</span>
<span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32164</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">28082</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-port</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rust-dedicated-server</span>
<span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rust</span>
</code></pre></div>
<h2>Check Service configuration</h2>
<p>After installing the Service, it takes a while until kube-vip assigns the external ingress IP address and the egress
configuration. Check the logs of kube-vip-cloud-provider pods for the handling of external ingress IP address. Or
the logs of kube-vip pod for egress handling. You should see ingress IP assigned (status) and
<a href="https://kube-vip.io/docs/usage/egress/#understanding-the-egress-configuration">egress configuration</a> (annotations) in
the Service object:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>-n<span class="w"> </span>yournamespace<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>yourservice<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span>
</code></pre></div>
</div>
</div>
</body>
</html>